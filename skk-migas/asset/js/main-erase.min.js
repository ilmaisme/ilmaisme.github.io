$(document).ready((function(){!function(t){var e={init:function(o){return this.each((function(){var a=t(this),r=a.data("eraser");if(!r){var n=a.width(),i=a.height(),c=a.offset(),u=t("<canvas/>"),s=u.get(0),h=o&&o.size?o.size:100,l=o&&o.completeRatio?o.completeRatio:.7,p=o&&o.completeFunction?o.completeFunction:null,f=[],m=Math.floor(n/h),v=m*Math.floor(i/h),d=v,g=s.getContext("2d");for(a.after(u),s.id=this.id,s.className=this.className,s.width=n,s.height=i,g.drawImage(this,0,0),a.remove(),g.globalCompositeOperation="destination-out",g.strokeStyle="rgba(255,0,0,255)",g.lineWidth=h,g.lineCap="round",u.bind("mouseenter.eraser",e.mouseDown),u.bind("mouseenter.eraser",e.touchStart),u.bind("touchmove.eraser",e.touchMove),u.bind("mouseleave.eraser",e.touchEnd);d--;)f.push(1);r={posX:c.left,posY:c.top,touchDown:!1,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:u,ctx:g,w:n,h:i,source:this,size:h,parts:f,colParts:m,numParts:v,ratio:0,complete:!1,completeRatio:l,completeFunction:p},u.data("eraser",r),t(window).resize((function(){var t=u.offset();r.posX=t.left,r.posY=t.top}))}}))},touchStart:function(o){var a=t(this).data("eraser");if(!a.touchDown){var r=o.originalEvent.changedTouches[0],n=r.pageX-a.posX,i=r.pageY-a.posY;e.evaluatePoint(a,n,i),a.touchDown=!0,a.touchID=r.identifier,a.touchX=n,a.touchY=i,o.preventDefault()}},touchMove:function(o){var a=t(this).data("eraser");if(a.touchDown)for(var r=o.originalEvent.changedTouches,n=r.length;n--;)if(r[n].identifier==a.touchID){var i=r[n].pageX-a.posX,c=r[n].pageY-a.posY;e.evaluatePoint(a,i,c),a.ctx.beginPath(),a.ctx.moveTo(a.touchX,a.touchY),a.touchX=i,a.touchY=c,a.ctx.lineTo(a.touchX,a.touchY),a.ctx.stroke(),o.preventDefault();break}},touchEnd:function(e){var o=t(this).data("eraser");if(o.touchDown)for(var a=e.originalEvent.changedTouches,r=a.length;r--;)if(a[r].identifier==o.touchID){o.touchDown=!1,e.preventDefault();break}},evaluatePoint:function(t,e,o){var a=Math.floor(e/t.size)+Math.floor(o/t.size)*t.colParts;a>=0&&a<t.numParts&&(t.ratio+=t.parts[a],t.parts[a]=0,t.complete||t.ratio/t.numParts>=t.completeRatio&&(t.complete=!0,null!=t.completeFunction&&t.completeFunction()))},mouseDown:function(o){var a=t(this),r=a.data("eraser"),n=o.pageX-r.posX,i=o.pageY-r.posY;e.evaluatePoint(r,n,i),r.touchDown=!0,r.touchX=n,r.touchY=i,r.ctx.beginPath(),r.ctx.moveTo(r.touchX-1,r.touchY),r.ctx.lineTo(r.touchX,r.touchY),r.ctx.stroke(),a.bind("mousemove.eraser",e.mouseMove),t(document).bind("mouseup.eraser",r,e.mouseUp),o.preventDefault()},mouseMove:function(o){var a=t(this).data("eraser"),r=o.pageX-a.posX,n=o.pageY-a.posY;e.evaluatePoint(a,r,n),a.ctx.beginPath(),a.ctx.moveTo(a.touchX,a.touchY),a.touchX=r,a.touchY=n,a.ctx.lineTo(a.touchX,a.touchY),a.ctx.stroke(),o.preventDefault()},mouseUp:function(e){var o=e.data,a=o.canvas;o.touchDown=!1,a.unbind("mousemove.eraser"),t(document).unbind("mouseup.eraser"),e.preventDefault()},clear:function(){var e=t(this).data("eraser");if(e){e.ctx.clearRect(0,0,e.w,e.h);for(var o=e.numParts;o--;)e.parts[o]=0;e.ratio=e.numParts,e.complete=!0,null!=e.completeFunction&&e.completeFunction()}},size:function(e){var o=t(this).data("eraser");o&&e&&(o.size=e,o.ctx.lineWidth=e)},reset:function(){var e=t(this).data("eraser");if(e){e.ctx.globalCompositeOperation="source-over",e.ctx.drawImage(e.source,0,0),e.ctx.globalCompositeOperation="destination-out";for(var o=e.numParts;o--;)e.parts[o]=1;e.ratio=0,e.complete=!1}}};t.fn.eraser=function(o){return e[o]?e[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void t.error("Method "+o+" does not yet exist on jQuery.eraser"):e.init.apply(this,arguments)}}(jQuery),addEventListener("load",(function(t){$("#redux").eraser({size:30})}),!1)}));