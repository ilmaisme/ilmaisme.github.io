gsap.registerPlugin(ScrollTrigger);const scrollTrack=document.querySelector(".scroll-track"),ship=document.querySelector(".ship"),panels=Array.from(scrollTrack.children),section4Boxes=gsap.utils.toArray(".section4Box");let scrollTween=null;const images=document.querySelectorAll("img");let loadedCount=0;function onImageLoaded(){loadedCount++,loadedCount===images.length&&handleViewportChangeImmediate()}function getViewportHeight(){return window.visualViewport?window.visualViewport.height:window.innerHeight}function updateScrollTrackHeight(){scrollTrack.style.height=getViewportHeight()+"px"}function updateScrollTrackWidth(){const e=panels.reduce(((e,t)=>e+t.offsetWidth),0);scrollTrack.style.width=e+"px"}function getTotalScroll(){return scrollTrack.scrollWidth-window.innerWidth}function initHorizontalScroll(){if(scrollTween){try{scrollTween.scrollTrigger.kill()}catch(e){}try{scrollTween.kill()}catch(e){}}scrollTween=gsap.to(scrollTrack,{x:()=>-getTotalScroll(),ease:"none",scrollTrigger:{trigger:".scroll-area",start:"top top",end:()=>"+="+getTotalScroll(),scrub:!0,pin:!0,anticipatePin:1}})}function handleViewportChangeImmediate(){updateScrollTrackHeight(),updateScrollTrackWidth(),initHorizontalScroll(),ScrollTrigger.refresh()}function debounce(e,t=120){let o;return function(...r){clearTimeout(o),o=setTimeout((()=>e.apply(this,r)),t)}}0===images.length?loadedCount=0:images.forEach((e=>{e.complete?onImageLoaded():(e.addEventListener("load",onImageLoaded),e.addEventListener("error",onImageLoaded))}));const handleViewportChange=debounce(handleViewportChangeImmediate,120);window.addEventListener("load",handleViewportChangeImmediate),window.addEventListener("resize",handleViewportChange),window.addEventListener("orientationchange",handleViewportChange),window.visualViewport&&(window.visualViewport.addEventListener("resize",handleViewportChange),window.visualViewport.addEventListener("scroll",updateScrollTrackHeight)),loadedCount===images.length&&handleViewportChangeImmediate(),gsap.from(section4Boxes,{x:-150,opacity:0,ease:"power2.out",stagger:{each:1},scrollTrigger:{trigger:".scroll-area",start:"top top",end:()=>"+="+getTotalScroll(),scrub:!0,markers:!1}});